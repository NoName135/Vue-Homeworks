import{_ as $,o as d,c as l,u as I,a as t,F as h,h as S,l as H,i as V,e as f,r as k,g as m,v as p,b,w as B,j as A,x as L,q as N,d as g,t as _,m as E,f as v}from"./index-a566e439.js";import{M as D}from"./modal-34ee6905.js";import{p as R}from"./Pagination-ecd06172.js";const F={props:["index"],emits:["changeImg"],methods:{handleFile(e,o,a){const r=e.target.files[0],s=new FormData;s.append("file-to-upload",r),r&&axios.post(`${apiUrl}/api/${apiPath}/admin/upload`,s).then(c=>{const u=c.data.imageUrl;this.$emit("changeImg",a,o,u)}).catch(c=>{alert(c.response.data.message)})}}};function z(e,o,a,r,s,c){return d(),l(h,null,[I(e.$slots,"main",{},()=>[t("input",{type:"file",class:"form-control",onChange:o[0]||(o[0]=u=>c.handleFile(u,"imageUrl"))},null,32)]),I(e.$slots,"multi",{},()=>[t("input",{type:"file",class:"form-control",onChange:o[1]||(o[1]=u=>c.handleFile(u,"imagesUrl",a.index))},null,32)])],64)}const O=$(F,[["render",z]]),{VITE_API:j,VITE_PATH:q}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"weekhomeworks",BASE_URL:"/Vue-Homeworks/week6/dist",MODE:"production",DEV:!1,PROD:!0},y=S("products",{state:()=>({products:[],pagination:{}}),actions:{getProducts(e=1){const{loadings:o}=H();o.isLoading=!0,V.get(`${j}/api/${q}/admin/products?page=${e}`).then(a=>{const{products:r,pagination:s}=a.data;this.products=r,this.pagination=s,o.isLoading=!1}).catch(a=>{o.isLoading=!1,alert(a.response.data.message)})}},getters:{}}),{VITE_API:w,VITE_PATH:U}={VITE_API:"https://vue3-course-api.hexschool.io/v2/",VITE_PATH:"weekhomeworks",BASE_URL:"/Vue-Homeworks/week6/dist",MODE:"production",DEV:!1,PROD:!0},{getProducts:T}=y(),C=S("modalStore",{state:()=>({productModal:{},delProductModal:{},isNew:!1,tempProduct:{}}),actions:{createProductModalRef(e){this.productModal=e},createDeleteModalRef(e){this.delProductModal=e},openModal(e,o){e==="new"?(this.isNew=!0,this.tempProduct={imagesUrl:[],is_enabled:0},this.productModal.modalShow()):e==="edit"?(this.isNew=!1,{...o}.imagesUrl?this.tempProduct={...o}:this.tempProduct={...o,imagesUrl:[]},this.productModal.modalShow()):e==="delete"&&(this.tempProduct={...o},this.delProductModal.modalShow())},hideModal(e){e==="updateProduct"?this.productModal.modalHide():this.delProductModal.modalHide()},updateProduct(e){let o="post",a=`${w}/api/${U}/admin/product`;this.isNew||(o="put",a=`${w}/api/${U}/admin/product/${this.tempProduct.id}`),V[o](a,{data:this.tempProduct}).then(r=>{alert(r.data.message),this.productModal.modalHide(),T(e)}).catch(r=>{var s;alert((s=r.response)==null?void 0:s.data.message)})},deleteProduct(e){V.delete(`${w}/api/${U}/admin/product/${this.tempProduct.id}`).then(o=>{alert(o.data.message),this.delProductModal.modalHide(),T(e)}).catch(o=>{alert(o.response.data.message)})}},getters:{}}),G={data(){return{modal:""}},methods:{modalShow(){this.modal.show()},modalHide(){this.modal.hide()},changeImage(e,o,a){e===void 0?this.tempProduct[o]=a:this.tempProduct[o][e]=a}},computed:{...f(C,["tempProduct","isNew","updateProduct"]),...f(y,["pagination"])},mounted(){this.modal=new D(this.$refs.modal,{keyboard:!1,backdrop:"static"})},components:{UploadImg:O}},J={id:"productModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"productModalLabel","aria-hidden":"true"},K={class:"modal-dialog modal-xl"},Q={class:"modal-content border-0"},W={class:"modal-header bg-dark text-white"},X={id:"productModalLabel",class:"modal-title"},Y={key:0},Z={key:1},x=t("button",{type:"button",class:"btn-close bg-white","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),tt={class:"modal-body"},et={class:"row"},ot={class:"col-sm-4"},st={class:"mb-2"},dt={class:"mb-3"},lt=t("label",{for:"imageUrl",class:"form-label"},"主要圖片 (請輸入網址或上傳圖片)",-1),nt=t("span",null,null,-1),it=["src"],at=t("h3",{class:"mb-3"},"多圖新增",-1),rt={class:"mb-3"},ct=["for"],ut=["id","onUpdate:modelValue"],mt=t("span",null,null,-1),pt=["src"],ht={key:0},gt={key:1},_t={class:"col-sm-8"},bt={class:"mb-3"},ft=t("label",{for:"title",class:"form-label"},"標題",-1),yt={class:"row"},Pt={class:"mb-3 col-md-6"},vt=t("label",{for:"category",class:"form-label"},"分類",-1),kt={class:"mb-3 col-md-6"},$t=t("label",{for:"price",class:"form-label"},"單位",-1),Mt={class:"row"},wt={class:"mb-3 col-md-6"},Ut=t("label",{for:"origin_price",class:"form-label"},"原價",-1),Vt={class:"mb-3 col-md-6"},Ct=t("label",{for:"price",class:"form-label"},"售價",-1),It=t("hr",null,null,-1),Bt={class:"mb-3"},Et=t("label",{for:"description",class:"form-label"},"產品描述",-1),Tt={class:"mb-3"},St=t("label",{for:"content",class:"form-label"},"說明內容",-1),At={class:"mb-3"},Dt={class:"form-check"},Ht=t("label",{class:"form-check-label",for:"is_enabled"},"是否啟用",-1),Lt={class:"modal-footer"},Nt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1),Rt=["disabled"];function Ft(e,o,a,r,s,c){var P;const u=k("UploadImg");return d(),l("div",J,[t("div",K,[t("div",Q,[t("div",W,[t("h5",X,[e.isNew?(d(),l("span",Y,"新增產品")):(d(),l("span",Z,"編輯產品"))]),x]),t("div",tt,[t("div",et,[t("div",ot,[t("div",st,[t("div",dt,[lt,m(t("input",{id:"imageUrl","onUpdate:modelValue":o[0]||(o[0]=n=>e.tempProduct.imageUrl=n),type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,512),[[p,e.tempProduct.imageUrl,void 0,{lazy:!0}]]),b(u,{onChangeImg:c.changeImage},{multi:B(()=>[nt]),_:1},8,["onChangeImg"])]),t("img",{class:"img-fluid",src:e.tempProduct.imageUrl},null,8,it)]),at,(d(!0),l(h,null,A(e.tempProduct.imagesUrl,(n,i)=>(d(),l("div",{class:"mb-1",key:i},[t("div",rt,[t("label",{for:"imagesUrl"+i,class:"form-label"},"圖片網址 (請輸入網址或上傳圖片)",8,ct),m(t("input",{id:"imagesUrl"+i,"onUpdate:modelValue":M=>e.tempProduct.imagesUrl[i]=M,type:"text",class:"form-control mb-2",placeholder:"請輸入圖片連結"},null,8,ut),[[p,e.tempProduct.imagesUrl[i],void 0,{lazy:!0}]]),b(u,{index:i,onChangeImg:c.changeImage},{main:B(()=>[mt]),_:2},1032,["index","onChangeImg"])]),t("img",{class:"img-fluid",src:n},null,8,pt)]))),128)),!((P=e.tempProduct.imagesUrl)!=null&&P.length)||e.tempProduct.imagesUrl[e.tempProduct.imagesUrl.length-1]?(d(),l("div",ht,[t("button",{class:"btn btn-outline-primary btn-sm d-block w-100",onClick:o[1]||(o[1]=n=>e.tempProduct.imagesUrl.push(""))}," 新增圖片 ")])):(d(),l("div",gt,[t("button",{class:"btn btn-outline-danger btn-sm d-block w-100",onClick:o[2]||(o[2]=n=>e.tempProduct.imagesUrl.pop())}," 取消新增 ")]))]),t("div",_t,[t("div",bt,[ft,m(t("input",{id:"title",type:"text",class:"form-control",placeholder:"請輸入標題","onUpdate:modelValue":o[3]||(o[3]=n=>e.tempProduct.title=n)},null,512),[[p,e.tempProduct.title]])]),t("div",yt,[t("div",Pt,[vt,m(t("input",{id:"category",type:"text",class:"form-control",placeholder:"請輸入分類","onUpdate:modelValue":o[4]||(o[4]=n=>e.tempProduct.category=n)},null,512),[[p,e.tempProduct.category]])]),t("div",kt,[$t,m(t("input",{id:"unit",type:"text",class:"form-control",placeholder:"請輸入單位","onUpdate:modelValue":o[5]||(o[5]=n=>e.tempProduct.unit=n)},null,512),[[p,e.tempProduct.unit]])])]),t("div",Mt,[t("div",wt,[Ut,m(t("input",{id:"origin_price",type:"number",min:"0",class:"form-control",placeholder:"請輸入原價","onUpdate:modelValue":o[6]||(o[6]=n=>e.tempProduct.origin_price=n)},null,512),[[p,e.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",Vt,[Ct,m(t("input",{id:"price",type:"number",min:"0",class:"form-control",placeholder:"請輸入售價","onUpdate:modelValue":o[7]||(o[7]=n=>e.tempProduct.price=n)},null,512),[[p,e.tempProduct.price,void 0,{number:!0}]])])]),It,t("div",Bt,[Et,m(t("textarea",{id:"description",type:"text",class:"form-control",placeholder:"請輸入產品描述","onUpdate:modelValue":o[8]||(o[8]=n=>e.tempProduct.description=n)},`
                `,512),[[p,e.tempProduct.description]])]),t("div",Tt,[St,m(t("textarea",{id:"content",type:"text",class:"form-control",placeholder:"請輸入說明內容","onUpdate:modelValue":o[9]||(o[9]=n=>e.tempProduct.content=n)},`
                `,512),[[p,e.tempProduct.content]])]),t("div",At,[t("div",Dt,[m(t("input",{id:"is_enabled",class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,"onUpdate:modelValue":o[10]||(o[10]=n=>e.tempProduct.is_enabled=n)},null,512),[[L,e.tempProduct.is_enabled]]),Ht])])])])]),t("div",Lt,[Nt,t("button",{type:"button",class:"btn btn-primary",onClick:o[11]||(o[11]=N(n=>e.updateProduct(e.pagination.current_page),["prevent"])),disabled:!e.tempProduct.title||!e.tempProduct.category||!e.tempProduct.unit||!e.tempProduct.origin_price||!e.tempProduct.price}," 確認 ",8,Rt)])])])],512)}const zt=$(G,[["render",Ft]]),Ot={data(){return{modal:""}},methods:{modalShow(){this.modal.show()},modalHide(){this.modal.hide()}},computed:{...f(C,["tempProduct","deleteProduct"]),...f(y,["pagination"])},mounted(){this.modal=new D(this.$refs.modal,{keyboard:!1,backdrop:"static"})}},jt={id:"delProductModal",ref:"modal",class:"modal fade",tabindex:"-1","aria-labelledby":"delProductModalLabel","aria-hidden":"true"},qt={class:"modal-dialog"},Gt={class:"modal-content border-0"},Jt=t("div",{class:"modal-header bg-danger text-white"},[t("h5",{id:"delProductModalLabel",class:"modal-title"},[t("span",null,"刪除產品")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),Kt={class:"modal-body"},Qt=t("strong",{class:"text-danger"},null,-1),Wt={class:"modal-footer"},Xt=t("button",{type:"button",class:"btn btn-outline-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function Yt(e,o,a,r,s,c){return d(),l("div",jt,[t("div",qt,[t("div",Gt,[Jt,t("div",Kt,[g(" 是否刪除 "),Qt,g(" "+_(e.tempProduct.title)+" (刪除後無法恢復)。 ",1)]),t("div",Wt,[Xt,t("button",{type:"button",class:"btn btn-danger",onClick:o[0]||(o[0]=u=>e.deleteProduct(e.pagination.current_page))}," 確認刪除 ")])])])],512)}const Zt=$(Ot,[["render",Yt]]),xt={data(){return{ascending:!1,sortBy:""}},methods:{...E(C,["createProductModalRef","createDeleteModalRef","openModal"]),...E(y,["getProducts"])},computed:{...f(y,["products","pagination"]),sortProductsPrice(){return this.sortBy==="category"?[...this.products].sort((e,o)=>this.ascending?e.category.localeCompare(o.category,"zh-hant"):o.category.localeCompare(e.category,"zh-hant")):this.sortBy?[...this.products].sort((e,o)=>this.ascending?e[this.sortBy]-o[this.sortBy]:o[this.sortBy]-e[this.sortBy]):this.products}},mounted(){const e=this.$refs.productModal;this.createProductModalRef(e);const o=this.$refs.deleteModal;this.createDeleteModalRef(o),this.getProducts()},components:{productModal:zt,deleteModal:Zt,pagination:R}},te=t("h4",{class:"text-center"},"這裡是 後台 產品列表",-1),ee={class:"text-end mt-4"},oe={class:"table mt-4"},se={key:0},de={key:1},le=t("th",null,"產品名稱",-1),ne={key:0},ie={key:1},ae={key:0},re={key:1},ce={key:0},ue={key:1},me=t("th",{width:"120"},"編輯",-1),pe={class:"text-end"},he={class:"text-end"},ge={key:0,class:"text-success"},_e={key:1},be={class:"btn-group"},fe=["onClick"],ye=["onClick"];function Pe(e,o,a,r,s,c){const u=k("pagination"),P=k("product-modal"),n=k("delete-modal");return d(),l(h,null,[te,t("div",ee,[t("button",{class:"btn btn-primary",onClick:o[0]||(o[0]=i=>e.openModal("new"))}," 建立新的產品 ")]),t("table",oe,[t("thead",null,[t("tr",null,[t("th",{width:"120",style:{cursor:"pointer"},onClick:o[1]||(o[1]=i=>{s.sortBy="category",s.ascending=s.sortBy==="category"?!s.ascending:!0})},[g(" 分類 "),s.sortBy==="category"?(d(),l(h,{key:0},[s.ascending?(d(),l("span",se,"▲")):(d(),l("span",de,"▼"))],64)):v("",!0)]),le,t("th",{width:"120",style:{cursor:"pointer"},onClick:o[2]||(o[2]=i=>{s.sortBy="origin_price",s.ascending=s.sortBy==="origin_price"?!s.ascending:!0})},[g(" 原價 "),s.sortBy==="origin_price"?(d(),l(h,{key:0},[s.ascending?(d(),l("span",ne,"▲")):(d(),l("span",ie,"▼"))],64)):v("",!0)]),t("th",{width:"120",style:{cursor:"pointer"},onClick:o[3]||(o[3]=i=>{s.sortBy="price",s.ascending=s.sortBy==="price"?!s.ascending:!0})},[g(" 售價 "),s.sortBy==="price"?(d(),l(h,{key:0},[s.ascending?(d(),l("span",ae,"▲")):(d(),l("span",re,"▼"))],64)):v("",!0)]),t("th",{width:"100",style:{cursor:"pointer"},onClick:o[4]||(o[4]=i=>{s.sortBy="is_enabled",s.ascending=s.sortBy==="is_enabled"?!s.ascending:!0})},[g(" 是否啟用 "),s.sortBy==="is_enabled"?(d(),l(h,{key:0},[s.ascending?(d(),l("span",ce,"▲")):(d(),l("span",ue,"▼"))],64)):v("",!0)]),me])]),t("tbody",null,[(d(!0),l(h,null,A(c.sortProductsPrice,i=>(d(),l("tr",{key:i.id},[t("td",null,_(i.category),1),t("td",null,_(i.title),1),t("td",pe,_(i.origin_price),1),t("td",he,_(i.price),1),t("td",null,[i.is_enabled?(d(),l("span",ge,"啟用")):(d(),l("span",_e,"未啟用"))]),t("td",null,[t("div",be,[t("button",{type:"button",class:"btn btn-outline-primary btn-sm",onClick:M=>e.openModal("edit",i)}," 編輯 ",8,fe),t("button",{type:"button",class:"btn btn-outline-danger btn-sm",onClick:M=>e.openModal("delete",i)}," 刪除 ",8,ye)])])]))),128))])]),b(u,{"page-obj":e.pagination,onEmitPage:e.getProducts},null,8,["page-obj","onEmitPage"]),b(P,{ref:"productModal"},null,512),b(n,{ref:"deleteModal"},null,512)],64)}const Me=$(xt,[["render",Pe]]);export{Me as default};
